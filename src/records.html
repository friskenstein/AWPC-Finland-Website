---
layout: layout.html
title: AWPC Finland
---

<h2>Ennätykset</h2>
<form method="get">
	<table id="filters" class="mx-[-4px] w-full">
		<tr>
			<td>Sukupuoli</td>
			<td>
				<div class="grid grid-cols-2 gap-1">
					<label><input type="radio" class="hidden" name="sex" value="M" />Miehet</label>
					<label><input type="radio" class="hidden" name="sex" value="F" />Naiset</label>
				</div>
			</td>
		</tr>
		<tr>
			<td>Tapahtuma</td>
			<td>
				<div class="grid grid-cols-2 gap-1">
					<label>
						<input type="checkbox" class="hidden" name="event" value="SBD" />Voimanosto</label>
					<label>
						<input type="checkbox" class="hidden" name="event" value="B/D" />Single-lift</label>
				</div>
			</td>
		</tr>
		<tr>
			<td>Varusteet</td>
			<td>
				<div class="grid grid-cols-2 gap-1">
					<label>
						<input type="checkbox" class="hidden" name="equipment" value="Bare" />Raw</label>
					<label>
						<input type="checkbox" class="hidden" name="equipment" value="Wraps" />
						Classic Raw</label>
					<label>
						<input type="checkbox" class="hidden" name="equipment" value="Single-ply" />Single-ply</label>
					<label>
						<input type="checkbox" class="hidden" name="equipment" value="Multi-ply" />Multi-ply</label>
					<label>
						<input type="checkbox" class="hidden" name="equipment" value="Unlimited" />Unlimited</label>
					<label class="italic text-neutral-400">
						<input type="checkbox" class="hidden" name="equipment" value="Sleeves" />Polvilämmitin</label>
				</div>
			</td>
		</tr>
		<tr>
			<td>Ikäluokka</td>
			<td>

				<div class="grid grid-cols-3 gap-1">
					<label><input type="checkbox" class="hidden" name="division"
							value="Open" />Avoin</label><label><input type="checkbox" class="hidden" name="division"
							value="Youth" />Lapset</label><label><input type="checkbox" class="hidden" name="division"
							value="T13-15" />T13-15</label><label><input type="checkbox" class="hidden" name="division"
							value="T16-17" />T16-17</label><label><input type="checkbox" class="hidden" name="division"
							value="T18-19" />T18-19</label><label><input type="checkbox" class="hidden" name="division"
							value="J20-23" />J20-23</label>
					<label><input type="checkbox" class="hidden" name="division"
							value="M40-44" />M40-44</label><label><input type="checkbox" class="hidden" name="division"
							value="M45-49" />M45-49</label><label><input type="checkbox" class="hidden" name="division"
							value="M50-54" />M50-54</label><label><input type="checkbox" class="hidden" name="division"
							value="M55-59" />M55-59</label><label><input type="checkbox" class="hidden" name="division"
							value="M60-64" />M60-64</label>
					<label><input type="checkbox" class="hidden" name="division" value="M65-69" />
						M65-69</label><label><input type="checkbox" class="hidden" name="division" value="M70-74" />
						M70-74</label><label><input type="checkbox" class="hidden" name="division" value="M75-79" />
						M75-79</label><label><input type="checkbox" class="hidden" name="division" value="M80+" />
						M80+
					</label>

				</div>
			</td>
		</tr>
		<tr>
			<td>Painoluokka</td>
			<td>

				<div class="grid grid-cols-4 gap-1">
					<label><input type="checkbox" class="hidden" name="class" value="44" />44</label><label><input
							type="checkbox" class="hidden" name="class" value="48" />48</label><label><input
							type="checkbox" class="hidden" name="class" value="52" />52</label><label><input
							type="checkbox" class="hidden" name="class" value="56" />56</label><label><input
							type="checkbox" class="hidden" name="class" value="60" />60</label><label><input
							type="checkbox" class="hidden" name="class" value="67.5" />67.5</label><label><input
							type="checkbox" class="hidden" name="class" value="75" />75</label><label><input
							type="checkbox" class="hidden" name="class" value="82.5" />82.5</label>
					<label><input type="checkbox" class="hidden" name="class" value="90" />90</label><label><input
							type="checkbox" class="hidden" name="class" value="100" />100</label><label><input
							type="checkbox" class="hidden" name="class" value="110" />110</label><label><input
							type="checkbox" class="hidden" name="class" value="125" />125</label><label><input
							type="checkbox" class="hidden" name="class" value="140" />140</label><label><input
							type="checkbox" class="hidden" name="class" value="SHW" />SHW</label>
				</div>
			</td>
		</tr>
		<tr>
			<td>Laji</td>
			<td>
				<div class="grid grid-cols-2 gap-1">
					<label><input type="checkbox" class="hidden" name="lift" value="S" />Kyykky</label><label><input
							type="checkbox" class="hidden" name="lift" value="B" />Penkki</label><label><input
							type="checkbox" class="hidden" name="lift" value="D" />Maastanosto</label><label><input
							type="checkbox" class="hidden" name="lift" value="SBD" />Yhteistulos</label>
				</div>
			</td>
		</tr>
	</table>
	<div class="flex justify-center mt-8">
		<button
			class="bg-gradient-to-b text-blue-100 from-blue-600 to-blue-900 disabled:from-neutral-600 disabled:to-neutral-900 disabled:opacity-50 disabled:cursor-not-allowed p-2 rounded-full w-16"
			id="search-button" type="submit">Hae</button>
	</div>
</form>

<div class="overflow-x-auto w-full">
	<table class="w-full mt-16 text-sm mx-[-4px]" id="records">
	</table>
</div>

<div id="pagination" class="mt-6 flex items-center justify-between">
	<div id="results-info" class="text-sm text-neutral-600"></div>
	<div class="flex gap-2">
		<button disabled
			class="bg-gradient-to-b text-blue-100 from-blue-600 to-blue-900 disabled:from-neutral-600 disabled:to-neutral-900 disabled:opacity-50 disabled:cursor-not-allowed p-2 rounded-full w-28"
			id="prev-page">Edellinen</button>
		<button disabled
			class="bg-gradient-to-b text-blue-100 from-blue-600 to-blue-900 disabled:from-neutral-600 disabled:to-neutral-900 disabled:opacity-50 disabled:cursor-not-allowed p-2 rounded-full w-28"
			id="next-page">Seuraava</button>
	</div>
</div>

<style>
	label {
		cursor: pointer;
		border: 1px solid #ccc;
		border-radius: 4px;
		padding: 1px 4px;
		white-space: nowrap;
	}

	label:has(input[type="checkbox"]:checked),
	label:has(input[type="radio"]:checked) {
		color: var(--color-blue-100);
		border: none;
		padding: 2px 5px;
		--tw-gradient-position: to bottom in oklab;
		background-image: linear-gradient(var(--tw-gradient-stops));
		--tw-gradient-from: var(--color-blue-600);
		--tw-gradient-to: var(--color-blue-900);
		--tw-gradient-stops: var(--tw-gradient-via-stops,
				var(--tw-gradient-position),
				var(--tw-gradient-from) var(--tw-gradient-from-position),
				var(--tw-gradient-to) var(--tw-gradient-to-position));
	}

	td {
		padding: 4px 8px;
	}

	table#filters td {
		vertical-align: top;
	}

	.first-row {
		display: none;
		@media (width >=40rem

			/* 640px */
		) {
			display: table-cell;
		}
	}

	.second-row {
		display: table-row;
		@media (width >=40rem

			/* 640px */
		) {
			display: none;
		}
	}

	table#records tr:nth-child(4n+3),
	table#records tr:nth-child(4n+4) {
		background-color: rgba(20, 71, 230, 0.05);
		;
	}
</style>
<script>
	(function () {
		const form = document.querySelector('form')
		const table = document.getElementById('records')
		const resultsInfo = document.getElementById('results-info')
		const searchBtn = document.getElementById('search-button')
		const prevBtn = document.getElementById('prev-page')
		const nextBtn = document.getElementById('next-page')

		let currentParams = new URLSearchParams()
		let currentPage = 1
		let totalPages = 1

		function getCheckedValues(name) {
			return Array.from(form.querySelectorAll(`input[name="${name}"]`))
				.filter((el) => el.checked)
				.map((el) => el.value)
		}

		function liftLabel(event, lift) {
			const fi = {S: 'JK', B: 'PP', D: 'MN', SBD: 'YT'}
			if (event === 'B' || event === 'D') {
				return `${fi[lift] || lift} <span class="text-xs" style="color:#e80f32;">(SL)</span>`
			}
			return fi[lift] || lift
		}

		async function fetchRecords(params) {
			const qs = params.toString()
			const url = '/api/records' + (qs ? `?${qs}` : '')
			const res = await fetch(url, {headers: {Accept: 'application/json'}})
			if (!res.ok) throw new Error(`HTTP ${res.status}`)
			return res.json()
		}

		function renderRows(items) {
			if (!Array.isArray(items) || items.length === 0) {
				table.innerHTML = '<tr><td colspan="6">Ei tuloksia</td></tr>'
				return
			}
			const rows = items
				.map((r) => {
					const liftText = liftLabel(r.event, r.lift)
					const eqText = r.equip === 'Bare' ? 'Raw' : r.equip === 'Wraps' ? 'Classic Raw' : r.equip
					const place = r.place ? r.place : ''
					const date = r.date ? r.date : ''
					return `
					<tr>
						<td>${r.class}</td>
						<td class="whitespace-nowrap">${eqText}</td>
						<td class="whitespace-nowrap">${liftText}</td>
						<td class="first-row font-semibold">${r.weight == 0 ? '' : r.weight}</td>
						<td class="first-row ${r.name === 'Standard' ? 'text-primary' : ''} whitespace-nowrap">${r.name || ''}</td>
						<td class="first-row text-xs">${date}&nbsp;${place}</td>
					</tr>
					<tr class="second-row">
						<td class="font-semibold">${r.weight == 0 ? '' : r.weight}</td>
						<td class="${r.name === 'Standard' ? 'text-primary' : ''} whitespace-nowrap">${r.name || ''}</td>
						<td class="text-xs">${date}&nbsp;${place}</td>
					</tr>`
				})
				.join('')
			table.innerHTML = rows
		}

		form.addEventListener('submit', async (e) => {
			e.preventDefault()
			const params = new URLSearchParams()
			const sexVals = getCheckedValues('sex')
			const eventVals = getCheckedValues('event')
			const equipVals = getCheckedValues('equipment')
			const divVals = getCheckedValues('division')
			const classVals = getCheckedValues('class')
			const liftVals = getCheckedValues('lift')

			sexVals.forEach((v) => params.append('sex', v))

			if (eventVals.includes('SBD')) {
				params.append('event', 'SBD')
			}
			if (eventVals.includes('B/D')) {
				params.append('event', 'B')
				params.append('event', 'D')
			}

			equipVals.forEach((v) => params.append('equip', v))
			divVals.forEach((v) => params.append('div', `${v}-D`))
			classVals.forEach((v) => params.append('class', v))
			liftVals.forEach((v) => params.append('lift', v))

			currentParams = params
			currentPage = 1
			await loadPage(currentPage)
		})

		async function loadPage(page) {
			const params = new URLSearchParams(currentParams)
			if (page && Number.isFinite(page)) params.set('page', String(page))
			// table.innerHTML = '<tr><td colspan="6">Ladataan…</td></tr>'
			searchBtn.disabled = true
			resultsInfo.textContent = ''
			prevBtn.disabled = true
			nextBtn.disabled = true
			try {
				const resp = await fetchRecords(params)
				const items = Array.isArray(resp) ? resp : (resp && resp.data) || []
				const meta = Array.isArray(resp) ? null : resp && resp.meta
				renderRows(items)
				if (meta) {
					const total = meta.total ?? 0
					const pageNo = meta.page ?? 1
					totalPages = meta.total_pages ?? 1
					currentPage = pageNo
					resultsInfo.textContent = `Tuloksia yhteensä: ${total}`
					prevBtn.disabled = pageNo <= 1
					nextBtn.disabled = pageNo >= totalPages
				} else {
					// Fallback if API doesn't provide meta
					currentPage = 1
					totalPages = 1
					prevBtn.disabled = true
					nextBtn.disabled = true
					resultsInfo.textContent = `Tuloksia yhteensä: ${items.length}`
				}
			} catch (err) {
				table.innerHTML = `<tr><td colspan=\"6\">Virhe haussa: ${String(err)}</td></tr>`
			} finally {
				searchBtn.disabled = false
			}
		}

		prevBtn.addEventListener('click', async (e) => {
			e.preventDefault()
			if (currentPage > 1) {
				await loadPage(currentPage - 1)
			}
		})

		nextBtn.addEventListener('click', async (e) => {
			e.preventDefault()
			if (currentPage < totalPages) {
				await loadPage(currentPage + 1)
			}
		})
	})()
</script>
